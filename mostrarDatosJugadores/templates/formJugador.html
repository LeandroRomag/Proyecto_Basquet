<div class="contenedor-buscador">
    <form id="form-buscar" class="form-buscar" method="post">
        {% csrf_token %}
        <label for="nombre_jugador">Buscar jugador:</label>
        <input type="text" id="id_nombre" name="nombre_jugador" maxlength="60">
        <button id="btn-buscar">Buscar</button>
    </form>
    <div id="div-jugadores" class="div-jugadores"></div>
</div>
<script>
    const inputNombre = document.getElementById('id_nombre');
    const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value; //SIRVE PARA CSRF
    const divContenidoJugadores = document.getElementById('div-jugadores');
    let texto = '';

    inputNombre.addEventListener('keyup', async function(event) {
        const teclaPrecionada = event.key;

        const teclasEspeciales = [
        "Alt",
        "AltGraph",
        "CapsLock",
        "Meta",
        "NumLock",
        "ScrollLock",
        "Shift",
        "Symbol",
        "SymbolLock",
        ];
    
        if (teclasEspeciales.includes(teclaPrecionada)) {
            // Ignora la tecla especial
            return;
        }
        
        if (event.key === "Backspace"){
            texto = texto.slice(0, -1);
        if (inputNombre.value.trim()===""){
            texto="";
        }
        } else if (event.key === "Control") {
            // Si se ha pegado texto, actualiza el valor de texto
            texto = inputNombre.value.trim();
        } else {
            texto += teclaPrecionada;
        }

        fetch('/jugador/buscar_jugadores/datos', {
            method: 'POST',
            credentials: 'same-origin',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({nombre: texto})
        })
        .then(response => response.json())
        .then(data => {
            const jugadores = data.jugadores;
            divContenidoJugadores.innerHTML = "";
            if (inputNombre.value!=""){
            jugadores.forEach(jugador => {
                divContenidoJugadores.innerHTML += `<a href="/jugador/${jugador.full_name}">${jugador.full_name}</a>`;
                });
            }
        })
        .catch(error => console.error('Error:', error));
    });

    //EVENTO SUBMIT
    const form = document.getElementById('form-buscar');
    const btnBuscar = document.getElementById('btn-buscar');

    form.addEventListener('submit', (e) => {
        e.preventDefault();

        const nombreJugador = document.getElementById('id_nombre').value;
        window.location.href = `/jugador/${nombreJugador}`;
    });
</script>